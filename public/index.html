<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Biomed Chat</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0b0b0b;
      --panel: #121212;
      --text: #f5f5f5;
      --muted: #9a9a9a;
      --border: #232323;
      --soft-border: #2a2a2a;
      --btn-bg: #ffffff;
      --btn-text: #0b0b0b;
      --code-bg: #0a0a0a;
      --code-border: #1d1d1d;
      --code-text: #f0f0f0;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body { margin: 0; font-family: 'Space Grotesk', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; background: var(--bg); color: var(--text); display: block; }
    .container { width: 100vw; max-width: none; height: 100vh; display: flex; flex-direction: column; padding: 0; gap: 0; }
    header { display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; border-bottom: 1px solid var(--border); background: var(--panel); border-radius: 0; flex-shrink: 0; }
    .title { display: flex; align-items: center; gap: 10px; font-weight: 700; letter-spacing: 0.2px; }
    .dot { width: 10px; height: 10px; border-radius: 50%; background: #fff; }
    .subtitle { color: var(--muted); font-weight: 500; font-size: 13px; }

    .chat { display: flex; flex-direction: column; overflow: hidden; min-height: 0; background: var(--panel); flex-grow: 1; }

    .messages { flex: 1; position: relative; padding: 16px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; scroll-behavior: smooth; }

    /* Centered ECG animation (visible when no messages) */
    .biomed-anim { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; pointer-events: none; opacity: 0.12; }
    .biomed-anim svg { width: 60%; max-width: 900px; min-width: 280px; }
    .ecg-path { stroke: #ffffff; stroke-width: 2; fill: none; stroke-linejoin: round; stroke-linecap: round; opacity: 0.9; filter: drop-shadow(0 0 6px rgba(255,255,255,0.12)); }
    .pulse-dot { fill: #ffffff; filter: drop-shadow(0 0 6px rgba(255,255,255,0.5)); }
    .messages.has-content .biomed-anim { display: none; }

    .bubble { max-width: 82%; padding: 10px 12px; border-radius: 10px; line-height: 1.55; border: 1px solid var(--soft-border); background: #0f0f0f; color: var(--text); }
    .bubble.user { white-space: pre-wrap; }
    .assistant { align-self: flex-start; background: #0f0f0f; }
    .user { align-self: flex-end; background: #131313; }

    /* Markdown inside assistant bubbles */
    .bubble .md { font-size: 15px; }
    .bubble .md h1, .bubble .md h2, .bubble .md h3 { margin: 0 0 8px; font-weight: 700; }
    .bubble .md h1 { font-size: 18px; }
    .bubble .md h2 { font-size: 17px; }
    .bubble .md h3 { font-size: 16px; }
    .bubble .md p { margin: 0 0 8px; }
    .bubble .md ul, .bubble .md ol { margin: 0 0 8px 18px; padding: 0; }
    .bubble .md code { background: var(--code-bg); border: 1px solid var(--code-border); color: var(--code-text); padding: 1px 4px; border-radius: 6px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; font-size: 0.95em; }
    .bubble .md pre { position: relative; background: var(--code-bg); border: 1px solid var(--code-border); color: var(--code-text); padding: 10px; border-radius: 8px; overflow: auto; }
    .bubble .md pre .copy-btn { position: absolute; top: 8px; right: 8px; background: #2a2a2a; border: 1px solid #3a3a3a; color: #f0f0f0; padding: 4px 8px; border-radius: 6px; cursor: pointer; font-size: 12px; }
    .bubble .md pre .copy-btn:hover { background: #3a3a3a; }
    .bubble .md pre code { border: 0; padding: 0; background: transparent; }
    .bubble .md hr { border: 0; border-top: 1px solid var(--soft-border); margin: 10px 0; }
    .bubble .md table { width: 100%; border-collapse: collapse; margin: 6px 0; }
    .bubble .md th, .bubble .md td { border: 1px solid var(--soft-border); padding: 6px; text-align: left; }

    /* Thinking indicator */
    .thinking { display: inline-flex; align-items: center; gap: 6px; color: var(--muted); }
    .thinking .dots { display: inline-flex; gap: 2px; }
    .thinking .dot { width: 4px; height: 4px; border-radius: 50%; background: var(--muted); opacity: 0.3; animation: blink 1.2s infinite; }
    .thinking .dot:nth-child(2) { animation-delay: 0.2s; }
    .thinking .dot:nth-child(3) { animation-delay: 0.4s; }
    @keyframes blink { 0%, 80%, 100% { opacity: 0.2 } 40% { opacity: 1 } }

    /* Textarea resizer handle (inside composer, above the textarea) */
    .ta-resizer { height: 10px; cursor: ns-resize; display: flex; align-items: center; justify-content: center; background: var(--panel); border-top: 1px solid var(--border); border-bottom: 1px solid var(--border); margin: 0 16px; }
    .ta-resizer .line { width: 60px; height: 2px; background: #2f2f2f; border-radius: 2px; }

    .composer { display: grid; grid-template-columns: 1fr auto; gap: 8px; padding: 10px 16px 12px; border-top: 1px solid var(--border); background: var(--panel); flex-shrink: 0; }
    textarea { width: 100%; resize: none; min-height: 100px; max-height: 60vh; border-radius: 10px; border: 1px solid var(--soft-border); padding: 12px 12px; background: #0e0e0e; color: var(--text); outline: none; line-height: 1.4; }

    .hidden { display: none !important; }
    .stop-btn { background: #f0f0f0; border-color: #e0e0e0; }
    .stop-btn .icon { width: 22px; height: 22px; }

    /* Send button styling */
    button.send { background: var(--btn-bg); color: var(--btn-text); border: 1px solid #e9e9e9; border-radius: 999px; height: 44px; padding: 0 18px; font-weight: 700; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; gap: 10px; transition: transform 0.12s ease, box-shadow 0.2s ease, background 0.15s ease, border-color 0.15s ease; box-shadow: 0 2px 10px rgba(0,0,0,0.25); }
    button.send .icon { width: 18px; height: 18px; transition: transform 0.12s ease; }
    button.send:hover { transform: translateY(-1px); box-shadow: 0 8px 22px rgba(0,0,0,0.35); }
    button.send:hover .icon { transform: translateX(2px); }
    button.send:active { transform: translateY(0); box-shadow: 0 3px 12px rgba(0,0,0,0.3); }
    button.send:disabled { opacity: 0.7; cursor: not-allowed; }

    /* Loading state */
    button.send .spinner { width: 16px; height: 16px; border: 2px solid var(--btn-text); border-right-color: transparent; border-radius: 50%; display: none; animation: spin 0.8s linear infinite; }
    button.send.loading .label { display: none; }
    button.send.loading .icon { display: none; }
    button.send.loading .spinner { display: inline-block; }
    @keyframes spin { to { transform: rotate(360deg); } }

    .hint { color: var(--muted); font-size: 12.5px; padding: 8px 16px; border-top: 1px solid var(--border); background: var(--panel); flex-shrink: 0; }
    .row { display: flex; gap: 8px; align-items: center; justify-content: space-between; }

    a.minilink { color: var(--muted); text-decoration: none; border-bottom: 1px dotted var(--soft-border); }
    a.minilink:hover { color: #fff; border-bottom-color: #fff; }

    /* Settings modal */
    .settings-btn { background: transparent; color: var(--muted); border: 1px solid var(--soft-border); border-radius: 8px; padding: 6px 10px; cursor: pointer; }
    .settings-btn:hover { color: #fff; border-color: #fff; }
    .modal { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,0.6); }
    .modal.open { display: flex; }
    .modal-card { background: #121826; border: 1px solid #222b45; padding: 20px; border-radius: 12px; width: 92%; max-width: 520px; }
    .modal h2 { margin: 0 0 12px; font-size: 18px; }
    .field { margin: 10px 0; }
    .field label { display: block; font-size: 12px; color: #a0acc0; margin-bottom: 6px; }
    .field input { width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid #2a3553; background: #0b1220; color: #e6eaf2; outline: none; }
    .row-actions { display: flex; gap: 8px; justify-content: flex-end; margin-top: 12px; }
    .btn { background: #2f6feb; color: white; border: none; padding: 10px 12px; border-radius: 8px; cursor: pointer; }
    .btn.secondary { background: #26324a; }
    .note { color: #8b97ad; font-size: 12px; margin-top: 8px; }
    .local-model-row { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
    .local-model-status { color: #8b97ad; font-size: 12px; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="title">
        <div class="dot"></div>
        <div>
          <div>Biomed Chat</div>
          <div class="subtitle">Your personal copilot for Biomedical Engineering</div>
        </div>
      </div>
      <div style="display:flex; gap:10px; align-items:center;">
        <a class="minilink" href="/health" target="_blank">server health</a>
        <button id="open-settings" class="settings-btn">Settings</button>
      </div>
    </header>

    <div class="chat" id="chat">
      <div id="messages" class="messages">
        <div class="biomed-anim" aria-hidden="true">
          <svg viewBox="0 0 1000 200" preserveAspectRatio="xMidYMid meet">
            <defs>
              <path id="ecgPath" d="M0 100 L120 100 140 96 160 104 180 100 210 100 230 88 240 100 255 100 275 58 285 140 295 68 305 100 325 100 345 94 355 100 375 100 395 100 415 100 435 100 455 96 475 104 495 100 520 100 540 90 550 100 565 100 585 56 595 142 605 64 615 100 635 100 650 98 665 100 685 100 705 100 725 100 745 100 765 96 785 104 805 100 825 100 845 90 855 100 875 100 895 58 905 140 915 68 925 100 940 100 960 100 980 100 1000 100" />
            </defs>
            <use href="#ecgPath" class="ecg-path" />
            <circle class="pulse-dot" r="3">
              <animateMotion dur="4s" repeatCount="indefinite" rotate="auto">
                <mpath href="#ecgPath" />
              </animateMotion>
            </circle>
          </svg>
        </div>
      </div>
      <div class="ta-resizer" id="ta-resizer" role="separator" aria-orientation="horizontal" title="Drag to resize textbox">
        <div class="line"></div>
      </div>
      <div class="composer">
        <textarea id="input" placeholder="Type your promptâ€¦"></textarea>
        <button id="send" class="send" aria-label="Send">
          <span class="label">Send</span>
          <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M4 12h14" stroke="#0b0b0b" stroke-width="2" stroke-linecap="round"/><path d="M14 6l6 6-6 6" stroke="#0b0b0b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <span class="spinner" aria-hidden="true"></span>
        </button>
        <button id="stop" class="send stop-btn hidden" aria-label="Stop">
          <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><rect x="6" y="6" width="12" height="12" rx="1" fill="#0b0b0b" /></svg>
        </button>
      </div>
    </div>

    <div class="row">
      <div class="hint">Concise. Assumes practitioner baseline. No fluff. Always verify content AI produces as it can be error prone. Made by Teddy Tennant and Roshan Sathish Sandhya.</div>
    </div>
  </div>
  <div id="settings-modal" class="modal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="settings-title">
      <h2 id="settings-title">Settings</h2>
      <div class="field">
        <label for="model-select">Model</label>
        <select id="model-select" class="settings-btn" style="width: 100%; padding-right: 28px; -webkit-appearance: none; -moz-appearance: none; appearance: none; background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="%239a9a9a'><path stroke-linecap='round' stroke-linejoin='round' d='m19.5 8.25-7.5 7.5-7.5-7.5' /></svg>'); background-position: right 8px center; background-repeat: no-repeat;">
          <option value="grok-4">Advanced</option>
          <option value="grok-3">Mid</option>
          <option value="grok-3-mini">Small</option>
          <option value="local-qwen-medical">Local Medical (Qwen 2.5 7B)</option>
        </select>
      </div>
      <div class="field">
        <label>Local Qwen Model</label>
        <div class="local-model-row">
          <span id="local-model-status" class="local-model-status">Checking status...</span>
          <button id="download-local-model" class="btn secondary" type="button">Download</button>
        </div>
  <p class="note">Downloads ~8&nbsp;GB of adapters. Falls back to CPU if no CUDA GPU is detected (much slower, includes an additional ~14&nbsp;GB download).</p>
      </div>
      <div class="row-actions">
        <button id="close-settings" class="btn secondary">Close</button>
      </div>
    </div>
  </div>
  <script type="module" src="/main.js"></script>
  <script>
    const modal = document.getElementById('settings-modal');
    const openBtn = document.getElementById('open-settings');
    const closeBtn = document.getElementById('close-settings');

    function openModal() {
      modal.classList.add('open');
      modal.setAttribute('aria-hidden', 'false');
    }
    function closeModal() {
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden', 'true');
    }
    openBtn.addEventListener('click', openModal);
    closeBtn.addEventListener('click', closeModal);

    // Close modal on ESC or overlay click
    modal.addEventListener('click', (e) => {
      if (e.target === modal) closeModal();
    });
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeModal();
    });
  </script>
</body>
</html> 